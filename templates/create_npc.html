<!-- templates/create_faction.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Faction for {{ campaign.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<h2>Create Faction for <strong>{{ campaign.name }}</strong></h2>

<form method="POST" action="{{ url_for('create_faction', campaign_id=campaign.id) }}">
    <div class="mb-4">
        <label class="form-label">Use Existing Master Faction (optional)</label>
        <select id="master_faction_id" name="master_faction_id" class="form-select">
            <option value="">-- Select Master Faction --</option>
            {% for mf in master_factions %}
                <option value="{{ mf.id }}"
                    data-name="{{ mf.name }}"
                    data-summary="{{ mf.summary }}"
                    data-type="{{ mf.faction_type }}"
                    data-base="{{ mf.base_location }}"
                    data-alignment="{{ mf.alignment }}"
                    data-leader="{{ mf.default_leader }}"
                    data-source="{{ mf.source }}"
                >
                    {{ mf.name }} ({{ mf.source }})
                </option>
            {% endfor %}
        </select>
    </div>

    <hr>
    <h5 class="mb-3">Or create a new faction:</h5>

    <div class="mb-3">
        <label class="form-label">Faction Name</label>
        <input type="text" name="name" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Summary</label>
        <textarea name="summary" class="form-control" rows="3" required></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">Faction Type</label>
        <select name="faction_type" class="form-select" required>
            {% for ft in faction_type_list %}
                <option value="{{ ft }}">{{ ft }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Base of Operations</label>
        <input type="text" name="base_location" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Alignment</label>
        <select name="alignment" class="form-select" required>
            {% for a in alignment_list %}
                <option value="{{ a }}">{{ a }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Leader Name</label>
        <input type="text" name="leader_name" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Source (optional)</label>
        <input type="text" name="source" class="form-control" placeholder="e.g. Waterdeep: Dragon Heist">
    </div>

    <button type="submit" class="btn btn-primary">Create Faction</button>
</form>

<script>
    document.getElementById('master_faction_id').addEventListener('change', function () {
        const selected = this.options[this.selectedIndex];
        if (!selected.value) return;

        document.querySelector('input[name="name"]').value = selected.dataset.name || '';
        document.querySelector('textarea[name="summary"]').value = selected.dataset.summary || '';
        document.querySelector('select[name="faction_type"]').value = selected.dataset.type || '';
        document.querySelector('input[name="base_location"]').value = selected.dataset.base || '';
        document.querySelector('select[name="alignment"]').value = selected.dataset.alignment || '';
        document.querySelector('input[name="leader_name"]').value = selected.dataset.leader || '';
        document.querySelector('input[name="source"]').value = selected.dataset.source || '';
    });
</script>

</body>
</html>
